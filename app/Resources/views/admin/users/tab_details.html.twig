{% import "macro.html.twig" as macro %}

<div class="columns">
    <div class="column full-width">
        <button type="button" id="btn-back">{{ 'button.back'|trans }}</button>
        <button type="button" id="btn-edit">{{ 'button.edit'|trans }}</button>
        <span class="buttonset">
            {% if user.id != app.user.id %}
            <button type="button" id="btn-disable">{{ user.disabled ? 'button.enable'|trans : 'button.disable'|trans }}</button>
            {% endif %}
            {% if not user.accountNonLocked %}
            <button type="button" id="btn-unlock">{{ 'button.unlock'|trans }}</button>
            {% endif %}
        </span>
    </div>
</div>

<div class="columns">
    <div class="column full-width">
        <fieldset>
            {{ macro.row('user.username'|trans, user.username) }}
            {{ macro.row('user.fullname'|trans, user.fullname) }}
            {{ macro.row('user.email'|trans, user.email) }}
            {{ macro.row('description'|trans, user.description) }}
            {{ macro.row('permissions'|trans, user.admin ? 'role.administrator'|trans : 'role.user'|trans) }}
            {% if user.accountNonLocked %}
                {{ macro.row('user.status'|trans, user.disabled ? 'user.disabled'|trans : 'user.enabled'|trans) }}
            {% else %}
                {{ macro.row('user.status'|trans, 'user.locked'|trans|lower) }}
            {% endif %}
        </fieldset>
    </div>
</div>

{% include 'admin/users/dlg_user.html.twig' %}

<script>

    $(function() {

        function reloadTab() {
            var $tabs = $('#btn-back').closest('.tabs');
            var current = $tabs.tabs('option', 'active');
            $tabs.tabs('load', current);
        }

        // "Back" button.
        $('#btn-back').click(function() {
            window.location.assign('{{ path('admin_users') }}');
        });

        // "Edit" button.
        $('#btn-edit').click(function() {
            {% if user.id == app.user.id %}
            $('#form_admin').disable(true);
            $('#form_disabled').disable(true);
            {% endif %}

            $('#dlg-user').modal({
                title: '{{ user.fullname }}',
                success: function() {
                    reloadTab();
                    return true;
                }
            });
        });

        // "Disable"/"Enable" button.
        $('#btn-disable').click(function() {
            $.post('{{ path(user.disabled ? 'admin_enable_user' : 'admin_disable_user') }}', { ids: [{{ user.id }}] }, function() {
                reloadTab();
            });
        });

        // "Unlock" button.
        $('#btn-unlock').click(function() {
            $.post('{{ path('admin_unlock_user', {'id': user.id}) }}', function() {
                reloadTab();
            });
        });
    });

</script>
